{% extends "base.html" %}
{% block content %}
<nav class="bg-gray-800 text-white p-4 mb-6 rounded-lg">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <a href="{{ url_for('index', page='dashboard') }}" class="hover:bg-gray-700 px-3 py-2 rounded {{ 'bg-gray-700' if page == 'dashboard' else '' }}">Dashboard</a>
            <a href="{{ url_for('index', page='pending') }}" class="hover:bg-gray-700 px-3 py-2 rounded {{ 'bg-gray-700' if page == 'pending' else '' }}">Pending</a>
            <a href="{{ url_for('index', page='devices') }}" class="hover:bg-gray-700 px-3 py-2 rounded {{ 'bg-gray-700' if page == 'devices' else '' }}">Devices</a>
            {% if session['username'] == 'admin' %}
                <a href="{{ url_for('index', page='settings') }}" class="hover:bg-gray-700 px-3 py-2 rounded {{ 'bg-gray-700' if page == 'settings' else '' }}">Settings</a>
            {% endif %}
        </div>
        <div>
            <a href="{{ url_for('logout') }}" class="hover:bg-gray-700 px-3 py-2 rounded">Logout</a>
        </div>
    </div>
</nav>

{% if page == 'dashboard' %}
<div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">Dashboard</h2>
    <p>Status and system insights will be displayed here.</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="bg-gray-100 p-4 rounded-lg">
            <h3 class="text-lg font-medium">Pending Devices</h3>
            <p>{{ devices|length }} devices awaiting authorization</p>
        </div>
        <div class="bg-gray-100 p-4 rounded-lg">
            <h3 class="text-lg font-medium">Authorized Devices</h3>
            <p>{{ mab_devices|length }} devices authorized</p>
        </div>
    </div>
</div>

{% elif page == 'pending' %}
<div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">Pending Devices for Authorization</h2>
    <table class="w-full table-auto">
        <thead>
            <tr class="bg-gray-200">
                <th class="px-4 py-2">MAC Address</th>
                <th class="px-4 py-2">Seen On</th>
                <th class="px-4 py-2">Switch</th>
                <th class="px-4 py-2">Location</th>
                <th class="px-4 py-2">Port</th>
                <th class="px-4 py-2">Authorize</th>
            </tr>
        </thead>
        <tbody>
            {% for device in devices %}
            <tr class="border-t">
                <td class="px-4 py-2">{{ device.mac }}</td>
                <td class="px-4 py-2">{{ device.seen }}</td>
                <td class="px-4 py-2">{{ device.switch }}</td>
                <td class="px-4 py-2">{{ device.location }}</td>
                <td class="px-4 py-2">{{ device.port }}</td>
                <td class="px-4 py-2">
                    <form method="POST" action="{{ url_for('authorize_device') }}">
                        {{ authorize_form.hidden_tag() }}
                        <input type="hidden" name="mac" value="{{ device.mac }}">
                        {{ authorize_form.group(class="p-2 border rounded-md") }}
                        {{ authorize_form.submit(class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 mt-2") }}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div class="bg-white p-6 rounded-lg shadow-md mt-6">
    <h2 class="text-xl font-semibold mb-4">Manually Add New Device</h2>
    <a href="{{ url_for('add_device') }}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Add New Device</a>
</div>

{% elif page == 'devices' %}
<div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">All MAB Devices</h2>
    <table class="w-full table-auto">
        <thead>
            <tr class="bg-gray-200">
                <th class="px-4 py-2">MAC Address</th>
                <th class="px-4 py-2">Description</th>
                <th class="px-4 py-2">Group</th>
                <th class="px-4 py-2">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for device in mab_devices %}
            <tr class="border-t">
                <td class="px-4 py-2">{{ device.mac }}</td>
                <td class="px-4 py-2">{{ device.desc }}</td>
                <td class="px-4 py-2">{{ device.group }}</td>
                <td class="px-4 py-2">
                    <a href="{{ url_for('edit_device', mac=device.mac) }}" class="text-blue-500 hover:underline">Edit</a>
                    <form method="POST" action="{{ url_for('delete_device', mac=device.mac) }}" class="inline">
                        <button type="submit" class="text-red-500 hover:underline ml-4" onclick="return confirm('Are you sure you want to delete this device?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a href="{{ url_for('add_device') }}" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 mt-4 inline-block">Add New Device</a>
</div>

{% elif page == 'settings' %}
{% if session['username'] == 'admin' %}
<div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">Settings</h2>
    <p>Settings configuration will be added here.</p>
    <div class="mt-4">
        <h3 class="text-lg font-medium">System Configuration</h3>
        <p>Manage Cisco ISE integration settings, SNMP community strings, and user permissions.</p>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}
